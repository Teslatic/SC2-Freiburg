<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ghost: Agency.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Ghost
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">A reinforcement learning approach on SC2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Agency.py</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceAgency.html">    1</a></span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="stringliteral">Hendrik Vloet</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="stringliteral">Copyright (C) 2018 Hendrik Vloet</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="stringliteral">Public Domain</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"># ______________________________________________________________________________</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"># pysc imports</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">from</span> pysc2.agents <span class="keyword">import</span> base_agent</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">from</span> pysc2.env <span class="keyword">import</span> sc2_env</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">from</span> pysc2.lib <span class="keyword">import</span> actions, features, units</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">from</span> pysc2.env.environment <span class="keyword">import</span> StepType</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"># normal python imports</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">from</span> absl <span class="keyword">import</span> app</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">from</span> absl <span class="keyword">import</span> flags</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">from</span> absl <span class="keyword">import</span> logging</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">import</span> random</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">import</span> math</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">from</span> itertools <span class="keyword">import</span> count</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">import</span> os</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"># torch imports</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">import</span> torch</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> T</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="classAgency_1_1ReplayBuffer.html">   44</a></span>&#160;<span class="keyword">class </span><a class="code" href="classAgency_1_1ReplayBuffer.html">ReplayBuffer</a>(object):</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    </div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="classAgency_1_1ReplayBuffer.html#ae1d76f1730f31d4fa36c7f7490e7fa2c">   51</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1ReplayBuffer.html#ae1d76f1730f31d4fa36c7f7490e7fa2c">__init__</a>(self, capacity):</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aa7be9fdc4ca2207005cb997ecd16cefe">capacity</a> = capacity</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">memory</a> = []</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        self.<a class="code" href="classAgency_1_1ReplayBuffer.html#a74ddbf1602593e4d1de547773c61a67c">position</a> = 0</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        self.<a class="code" href="classAgency_1_1ReplayBuffer.html#a3472d419a502e3331128f223253d4a78">Transition</a> = namedtuple(<span class="stringliteral">&#39;Transition&#39;</span>,</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            (<span class="stringliteral">&#39;state&#39;</span>, <span class="stringliteral">&#39;action&#39;</span>, <span class="stringliteral">&#39;reward&#39;</span>, <span class="stringliteral">&#39;next_state&#39;</span>,</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;             <span class="stringliteral">&#39;step_type&#39;</span>))</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    </div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="classAgency_1_1ReplayBuffer.html#a7792c36c85702b20aadfd91ec4c4326f">   60</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1ReplayBuffer.html#a7792c36c85702b20aadfd91ec4c4326f">__len__</a>(self):</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">return</span> len(self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">memory</a>)</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    </div><div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="classAgency_1_1ReplayBuffer.html#ad6b534eb2f5e5d14a19504c543a061ac">   64</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1ReplayBuffer.html#ad6b534eb2f5e5d14a19504c543a061ac">__getitem__</a>(self, key):</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">memory</a>[key]</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    </div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classAgency_1_1ReplayBuffer.html#a42eb421de8a87af670f58c2c9f47819c">   68</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1ReplayBuffer.html#a42eb421de8a87af670f58c2c9f47819c">push</a>(self, *args):</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">memory</a>) &lt; self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aa7be9fdc4ca2207005cb997ecd16cefe">capacity</a>:</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">memory</a>.append(<span class="keywordtype">None</span>)</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">memory</a>[self.<a class="code" href="classAgency_1_1ReplayBuffer.html#a74ddbf1602593e4d1de547773c61a67c">position</a>] = self.<a class="code" href="classAgency_1_1ReplayBuffer.html#a3472d419a502e3331128f223253d4a78">Transition</a>(*args)</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        self.<a class="code" href="classAgency_1_1ReplayBuffer.html#a74ddbf1602593e4d1de547773c61a67c">position</a> = (self.<a class="code" href="classAgency_1_1ReplayBuffer.html#a74ddbf1602593e4d1de547773c61a67c">position</a>+1) % self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aa7be9fdc4ca2207005cb997ecd16cefe">capacity</a></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    </div><div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="classAgency_1_1ReplayBuffer.html#ad4826e3b32056d091daed1120862760c">   75</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1ReplayBuffer.html#ad4826e3b32056d091daed1120862760c">sample</a>(self, batch_size):</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keywordflow">return</span> random.sample(self.<a class="code" href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">memory</a>, batch_size)</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html">   87</a></span>&#160;<span class="keyword">class </span><a class="code" href="classAgency_1_1BaseAgent.html">BaseAgent</a>(base_agent.BaseAgent):</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    </div><div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a8000d3852f7eada76fd862a036e8c5ac">   89</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a8000d3852f7eada76fd862a036e8c5ac">__init__</a>(self,architecture, FLAGS, device=&quot;cpu&quot;):</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        super(BaseAgent, self).<a class="code" href="classAgency_1_1BaseAgent.html#a8000d3852f7eada76fd862a036e8c5ac">__init__</a>()</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        </div><div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aa9c49bc30c7714e60240621fa842c48f">   92</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#aa9c49bc30c7714e60240621fa842c48f">_name</a> = FLAGS.name</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        </div><div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a942e0ae66a7f7382a1176e49729979d1">   94</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a942e0ae66a7f7382a1176e49729979d1">_path</a> = FLAGS.path</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        </div><div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#af61223f2986231e1ffc18b5ee1c58d4a">   96</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#af61223f2986231e1ffc18b5ee1c58d4a">_lr</a> = FLAGS.learning_rate</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        </div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#af1ed6712db1813e675955005c17bade6">   98</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#af1ed6712db1813e675955005c17bade6">_gamma</a> = FLAGS.learning_rate</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        </div><div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a247146182d23b3ada0a4e851bedd3c37">  100</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a247146182d23b3ada0a4e851bedd3c37">_batch_size</a> = FLAGS.batch_size</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        </div><div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aa98b4697dd1efc2617cdff5a6f0a76a6">  102</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#aa98b4697dd1efc2617cdff5a6f0a76a6">_target_update</a> = FLAGS.target_update</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        </div><div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#ae50cf15d8a8e27257ebfc147109eee71">  104</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#ae50cf15d8a8e27257ebfc147109eee71">_epochs</a> = FLAGS.epochs</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        </div><div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aaae52ad633814dfe257eed442f5f4b7e">  106</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#aaae52ad633814dfe257eed442f5f4b7e">_memory_size</a> = FLAGS.memory_size</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        </div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a0c5ff3459c502c25ed79b01c9d779b63">  108</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a0c5ff3459c502c25ed79b01c9d779b63">_visualize</a> = FLAGS.visualize</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        </div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">  110</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a> = device</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        </div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a76d7d38e700e7d5a3da83bf2c3237856">  112</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a76d7d38e700e7d5a3da83bf2c3237856">_map_name</a> = FLAGS.map_name</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        </div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aefe924af6e56114594a6254df8ec0253">  114</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#aefe924af6e56114594a6254df8ec0253">_step_multiplier</a> = FLAGS.step_multiplier</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        </div><div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a001079ac67514da6784c687313065cea">  116</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a001079ac67514da6784c687313065cea">_eps_decay</a> = FLAGS.epsilon</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        </div><div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aac02c4ec3cb8092b0658a5016ca34da5">  118</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#aac02c4ec3cb8092b0658a5016ca34da5">epsilon</a> = 1.0</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        </div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a1a1ba863a11e4295203cadf4abcfeac3">  120</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a1a1ba863a11e4295203cadf4abcfeac3">_EPS_START</a> = 1.0</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        </div><div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#ad93eb985739706f8a17842953fda2d9c">  122</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#ad93eb985739706f8a17842953fda2d9c">_EPS_END</a> = 0.1</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        </div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a3c1c2888e59101190c71795031e89b6c">  124</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a3c1c2888e59101190c71795031e89b6c">_steps_done</a> = 0</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        </div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aed81b1c10d3a9efe5e98d0e15fd72a8f">  126</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#aed81b1c10d3a9efe5e98d0e15fd72a8f">_choice</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        </div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a0fd91f1d7a6e98d7a595a10cca3971f6">  128</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a0fd91f1d7a6e98d7a595a10cca3971f6">total_reward</a> = 0</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        </div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#ad1faa8d7c16f35e8b83a0e3ae176f59c">  130</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#ad1faa8d7c16f35e8b83a0e3ae176f59c">r_per_epoch</a> = []</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        </div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a1a07b769c1dc93900667c4fa575e78a2">  132</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a1a07b769c1dc93900667c4fa575e78a2">list_score_cumulative</a> = []</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        </div><div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a0b87389e4d22e2272d198de09114faff">  134</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a0b87389e4d22e2272d198de09114faff">_SMART_ACTIONS</a> = [</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            actions.FUNCTIONS.select_army.id,</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            actions.FUNCTIONS.Move_screen.id ]</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        </div><div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">  138</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">memory</a> = <a class="code" href="classAgency_1_1ReplayBuffer.html">ReplayBuffer</a>(self.<a class="code" href="classAgency_1_1BaseAgent.html#aaae52ad633814dfe257eed442f5f4b7e">_memory_size</a>)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        </div><div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a7809a1ed065d25c9c414b0a1176211d2">  140</a></span>&#160;        self._net, self._target_net, self.<a class="code" href="classAgency_1_1BaseAgent.html#a7809a1ed065d25c9c414b0a1176211d2">_optimizer</a> = \</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a7b6427b6a1ddf05110a588cbbcc7592b">_build_model</a>(architecture)</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        </div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a600366eed556fa0c9d077ae5635c244a">  143</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a600366eed556fa0c9d077ae5635c244a">_env</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#ac965ebdc21d12c9a39ce8e2b75f1c5b8">_build_env</a>()</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        </div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a9a114098d693d23c2b6024bff9ab4e3c">  145</a></span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a9a114098d693d23c2b6024bff9ab4e3c">_xy_pairs</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a7f90b138b07e8667a2fefd8f79e9b749">_discretize_xy_grid</a>(FLAGS.xy_grid)</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        print(<span class="stringliteral">&quot;Network: \n{}&quot;</span>.format(self._net))</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        print(<span class="stringliteral">&quot;Optimizer: \n{}&quot;</span>.format(self.<a class="code" href="classAgency_1_1BaseAgent.html#a7809a1ed065d25c9c414b0a1176211d2">_optimizer</a>))</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        print(<span class="stringliteral">&quot;Target Network: \n{}&quot;</span>.format(self._target_net))</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    </div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a7b6427b6a1ddf05110a588cbbcc7592b">  158</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a7b6427b6a1ddf05110a588cbbcc7592b">_build_model</a>(self, architecture):</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        net = architecture.to(self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>)</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;        target_net = architecture.to(self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>)</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        optimizer = optim.Adam(net.parameters(), lr=self.<a class="code" href="classAgency_1_1BaseAgent.html#af61223f2986231e1ffc18b5ee1c58d4a">_lr</a>)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <span class="keywordflow">return</span> net, target_net, optimizer</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    </div><div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#ac965ebdc21d12c9a39ce8e2b75f1c5b8">  170</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#ac965ebdc21d12c9a39ce8e2b75f1c5b8">_build_env</a>(self):</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        players = [sc2_env.Agent(sc2_env.Race.terran)]</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        interface = features.AgentInterfaceFormat(</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            feature_dimensions=features.Dimensions(screen=84,</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                minimap=84), use_feature_units = <span class="keyword">True</span>)</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        env = sc2_env.SC2Env(</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            map_name = self.<a class="code" href="classAgency_1_1BaseAgent.html#a76d7d38e700e7d5a3da83bf2c3237856">_map_name</a>,</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            players = players,</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            agent_interface_format = interface,</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            step_mul = self.<a class="code" href="classAgency_1_1BaseAgent.html#aefe924af6e56114594a6254df8ec0253">_step_multiplier</a>,</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            game_steps_per_episode = 0,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            visualize = self.<a class="code" href="classAgency_1_1BaseAgent.html#a0c5ff3459c502c25ed79b01c9d779b63">_visualize</a>)</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordflow">return</span> env</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    </div><div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a7f90b138b07e8667a2fefd8f79e9b749">  191</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a7f90b138b07e8667a2fefd8f79e9b749">_discretize_xy_grid</a>(self, factor):</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="stringliteral">&quot;&quot;&quot; &quot;discretizing&quot; action coordinates in order to keep action space small &quot;&quot;&quot;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        x_space = np.linspace(0, 83, factor, dtype = int)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        y_space = np.linspace(0, 63, factor, dtype = int)</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        xy_space = np.transpose([np.tile(x_space, len(y_space)),</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                   np.repeat(y_space, len(x_space))])</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="keywordflow">return</span> xy_space</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    </div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#ad0c1c3971f99373113ccfcb68f55ce61">  205</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#ad0c1c3971f99373113ccfcb68f55ce61">_xy_locs</a>(self, mask):</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        y, x = mask.nonzero()</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">return</span> list(zip(x, y))</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    </div><div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a101857f27c887a9599d064f582e58bfc">  212</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a101857f27c887a9599d064f582e58bfc">_save_model</a>(self):</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        save_path = self.<a class="code" href="classAgency_1_1BaseAgent.html#a942e0ae66a7f7382a1176e49729979d1">_path</a> + <span class="stringliteral">&quot;/experiment/&quot;</span> + self.<a class="code" href="classAgency_1_1BaseAgent.html#aa9c49bc30c7714e60240621fa842c48f">_name</a> + <span class="stringliteral">&quot;/model/model.pt&quot;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        Path((self.<a class="code" href="classAgency_1_1BaseAgent.html#a942e0ae66a7f7382a1176e49729979d1">_path</a> + <span class="stringliteral">&quot;/experiment/&quot;</span> + self.<a class="code" href="classAgency_1_1BaseAgent.html#aa9c49bc30c7714e60240621fa842c48f">_name</a> + <span class="stringliteral">&quot;/model&quot;</span>)).mkdir(parents=<span class="keyword">True</span>, exist_ok=<span class="keyword">True</span>)</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        torch.save(self._net.state_dict(), save_path)</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    </div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a387d924de5e98fc7e87e5750ffbc8116">  219</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a387d924de5e98fc7e87e5750ffbc8116">log_reward</a>(self):</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        r_per_epoch_save_path = self.<a class="code" href="classAgency_1_1BaseAgent.html#a942e0ae66a7f7382a1176e49729979d1">_path</a>  + <span class="stringliteral">&quot;/experiment/&quot;</span> + self.<a class="code" href="classAgency_1_1BaseAgent.html#aa9c49bc30c7714e60240621fa842c48f">_name</a> + <span class="stringliteral">&quot;/csv/reward_per_epoch.csv&quot;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        Path((self.<a class="code" href="classAgency_1_1BaseAgent.html#a942e0ae66a7f7382a1176e49729979d1">_path</a> + <span class="stringliteral">&quot;/experiment/&quot;</span> + self.<a class="code" href="classAgency_1_1BaseAgent.html#aa9c49bc30c7714e60240621fa842c48f">_name</a> + <span class="stringliteral">&quot;/csv&quot;</span>)).mkdir(parents=<span class="keyword">True</span>, exist_ok=<span class="keyword">True</span>)</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        d = {<span class="stringliteral">&quot;reward per epoch&quot;</span> : self.<a class="code" href="classAgency_1_1BaseAgent.html#ad1faa8d7c16f35e8b83a0e3ae176f59c">r_per_epoch</a>,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;             <span class="stringliteral">&quot;cumulative reward&quot;</span>: self.<a class="code" href="classAgency_1_1BaseAgent.html#a1a07b769c1dc93900667c4fa575e78a2">list_score_cumulative</a>}</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        df = pd.DataFrame(data=d)</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        with open(r_per_epoch_save_path, <span class="stringliteral">&quot;w&quot;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            df.to_csv(f, header=<span class="keyword">True</span>, index=<span class="keyword">False</span>)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    </div><div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a901aab539081be07996dca97de2f2e06">  233</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a901aab539081be07996dca97de2f2e06">decide</a>(self):</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">memory</a>) &gt;= self.<a class="code" href="classAgency_1_1BaseAgent.html#a247146182d23b3ada0a4e851bedd3c37">_batch_size</a>:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#aac02c4ec3cb8092b0658a5016ca34da5">epsilon</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#ad93eb985739706f8a17842953fda2d9c">_EPS_END</a> + (self.<a class="code" href="classAgency_1_1BaseAgent.html#a1a1ba863a11e4295203cadf4abcfeac3">_EPS_START</a> - self.<a class="code" href="classAgency_1_1BaseAgent.html#ad93eb985739706f8a17842953fda2d9c">_EPS_END</a>) \</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                * np.exp(-1. * self.<a class="code" href="classAgency_1_1BaseAgent.html#a3c1c2888e59101190c71795031e89b6c">_steps_done</a> / self.<a class="code" href="classAgency_1_1BaseAgent.html#a001079ac67514da6784c687313065cea">_eps_decay</a>)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a3c1c2888e59101190c71795031e89b6c">_steps_done</a> += 1</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a0bfa57fad07747f81f83d3e6f2c8a493">choice</a> = np.random.choice([<span class="stringliteral">&#39;random&#39;</span>, <span class="stringliteral">&#39;greedy&#39;</span>],</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                           p=[self.<a class="code" href="classAgency_1_1BaseAgent.html#aac02c4ec3cb8092b0658a5016ca34da5">epsilon</a>, 1-self.<a class="code" href="classAgency_1_1BaseAgent.html#aac02c4ec3cb8092b0658a5016ca34da5">epsilon</a>])</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a0bfa57fad07747f81f83d3e6f2c8a493">choice</a> = <span class="stringliteral">&#39;random&#39;</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    </div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a1f7d1b84d919eb3d2ce9092ad2161d1b">  250</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a1f7d1b84d919eb3d2ce9092ad2161d1b">choose_action</a>(self):</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a901aab539081be07996dca97de2f2e06">decide</a>()</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a0bfa57fad07747f81f83d3e6f2c8a493">choice</a> == <span class="stringliteral">&#39;random&#39;</span>:</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            </div><div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#adcc438ca0e3c70602fc3fd8941380dfd">  254</a></span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#adcc438ca0e3c70602fc3fd8941380dfd">action_idx</a> = torch.tensor([random.randint(0, len(self.<a class="code" href="classAgency_1_1BaseAgent.html#a9a114098d693d23c2b6024bff9ab4e3c">_xy_pairs</a>) - 1)],</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                           dtype=torch.long, device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            </div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a72269503c3be981fe59c51e6f46563c2">  257</a></span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a72269503c3be981fe59c51e6f46563c2">action_xy</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a9a114098d693d23c2b6024bff9ab4e3c">_xy_pairs</a>[self.<a class="code" href="classAgency_1_1BaseAgent.html#adcc438ca0e3c70602fc3fd8941380dfd">action_idx</a>]</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            with torch.no_grad():</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#a806c86c1018317a32f8a2b297b465ff4">action_q_values</a> = self._net(self.<a class="code" href="classAgency_1_1BaseAgent.html#ad1ba1f291bc8f4360668c8e02186f83a">state</a>)</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#adcc438ca0e3c70602fc3fd8941380dfd">action_idx</a> = torch.tensor([np.argmax(self.<a class="code" href="classAgency_1_1BaseAgent.html#a806c86c1018317a32f8a2b297b465ff4">action_q_values</a>)],</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                           dtype=torch.long, device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#a72269503c3be981fe59c51e6f46563c2">action_xy</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a9a114098d693d23c2b6024bff9ab4e3c">_xy_pairs</a>[self.<a class="code" href="classAgency_1_1BaseAgent.html#adcc438ca0e3c70602fc3fd8941380dfd">action_idx</a>]</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a9b17cee37319f16020cee6a23321c893">x_coord</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a72269503c3be981fe59c51e6f46563c2">action_xy</a>[0]</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a41d5c1c526ff266223f9b2e0ad7cf1c7">y_coord</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a72269503c3be981fe59c51e6f46563c2">action_xy</a>[1]</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment"># first action is always to select the army</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.first()==<span class="keyword">True</span>:</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            </div><div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">  270</a></span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">pysc_action</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a0b87389e4d22e2272d198de09114faff">_SMART_ACTIONS</a>[0]</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">pysc_action</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a0b87389e4d22e2272d198de09114faff">_SMART_ACTIONS</a>[1]</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a06cd034442fe41432486654dfafa0937">extract_action</a>()</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    </div><div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a06cd034442fe41432486654dfafa0937">  285</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a06cd034442fe41432486654dfafa0937">extract_action</a>(self):</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">pysc_action</a> <span class="keywordflow">in</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.observation.available_actions:</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">pysc_action</a> == 331:</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                </div><div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">  289</a></span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">action</a> = [actions.FUNCTIONS.Move_screen(<span class="stringliteral">&quot;now&quot;</span>,</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                                        (self.<a class="code" href="classAgency_1_1BaseAgent.html#a9b17cee37319f16020cee6a23321c893">x_coord</a>, self.<a class="code" href="classAgency_1_1BaseAgent.html#a41d5c1c526ff266223f9b2e0ad7cf1c7">y_coord</a>))]</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">pysc_action</a> == 7:</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">action</a> = [actions.FUNCTIONS.select_army(<span class="stringliteral">&quot;select&quot;</span>)]</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">pysc_action</a> == 0:</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">action</a> = [actions.FUNCTIONS.no_op()]</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">action</a> = [actions.FUNCTIONS.no_op()]</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    </div><div class="line"><a name="l00300"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a59f2f9a055e2c145bc83f610e26b8096">  300</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a59f2f9a055e2c145bc83f610e26b8096">step</a>(self):</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a1f7d1b84d919eb3d2ce9092ad2161d1b">choose_action</a>()</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    </div><div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a663f1d2913fa6a467077a55ddf854dae">  316</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a663f1d2913fa6a467077a55ddf854dae">calc_pseudo_reward</a>(self):</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a63134b494c76d05c1368abba3cefad16">beacon</a> = np.mean(self.<a class="code" href="classAgency_1_1BaseAgent.html#ad0c1c3971f99373113ccfcb68f55ce61">_xy_locs</a>(</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.observation.feature_screen.player_relative == 3),</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                             axis=0).round()</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            b_x, b_y = self.<a class="code" href="classAgency_1_1BaseAgent.html#a63134b494c76d05c1368abba3cefad16">beacon</a></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.first()==<span class="keyword">False</span>:</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="keywordflow">try</span>:</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                    marine = self.<a class="code" href="classAgency_1_1BaseAgent.html#ad0c1c3971f99373113ccfcb68f55ce61">_xy_locs</a>(self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.observation.feature_screen.selected == 1)</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                    marine = np.mean(marine, axis = 0).round()</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#aa1314c76c77fe992d5a3fa69ab5da6b3">marine_x</a> = marine[0]</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#a65cbef666a469ae84ecf1dc5aa57181d">marine_y</a> = marine[1]</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                    dx = self.<a class="code" href="classAgency_1_1BaseAgent.html#aa1314c76c77fe992d5a3fa69ab5da6b3">marine_x</a> - b_x</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    dy = self.<a class="code" href="classAgency_1_1BaseAgent.html#a65cbef666a469ae84ecf1dc5aa57181d">marine_y</a> - b_y</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                    distance = np.sqrt(dx**2 + dy**2).round()</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                    scaling = <span class="keyword">lambda</span> x : (x - 0)/(100 - 0)</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#abdaf34c55cf5c82b49b0b6592380e3e1">pseudo_reward</a> = (0.1 * (1 - scaling(distance))).round(2)</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                    <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">next_obs</a>[0].reward==1:</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                        self.<a class="code" href="classAgency_1_1BaseAgent.html#a4b3bda54eb9c1193f6ede50f32e95a2d">reward</a> = torch.tensor([self.<a class="code" href="classAgency_1_1BaseAgent.html#abdaf34c55cf5c82b49b0b6592380e3e1">pseudo_reward</a> + 10] , device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>,</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                                       requires_grad=<span class="keyword">True</span>, dtype=torch.float)</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                        self.<a class="code" href="classAgency_1_1BaseAgent.html#a4b3bda54eb9c1193f6ede50f32e95a2d">reward</a> = torch.tensor([self.<a class="code" href="classAgency_1_1BaseAgent.html#abdaf34c55cf5c82b49b0b6592380e3e1">pseudo_reward</a>] , device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>,</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                                                   requires_grad=<span class="keyword">True</span>, dtype=torch.float)</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <span class="keywordflow">except</span>:</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                    <span class="keywordflow">pass</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#aa1314c76c77fe992d5a3fa69ab5da6b3">marine_x</a> = -1</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#a65cbef666a469ae84ecf1dc5aa57181d">marine_y</a> = -1</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#a4b3bda54eb9c1193f6ede50f32e95a2d">reward</a> = torch.tensor([0] , device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                                       requires_grad=<span class="keyword">True</span>, dtype=torch.float)</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            self.<a class="code" href="classAgency_1_1BaseAgent.html#a0fd91f1d7a6e98d7a595a10cca3971f6">total_reward</a> += self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.reward</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    </div><div class="line"><a name="l00365"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#adef4f441aa6cbd1f3bb2c85839b9f403">  365</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#adef4f441aa6cbd1f3bb2c85839b9f403">optimize</a>(self):</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">memory</a>) &lt; self.<a class="code" href="classAgency_1_1BaseAgent.html#a247146182d23b3ada0a4e851bedd3c37">_batch_size</a>:</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <span class="keywordflow">return</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        transitions = self.<a class="code" href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">memory</a>.sample(self.<a class="code" href="classAgency_1_1BaseAgent.html#a247146182d23b3ada0a4e851bedd3c37">_batch_size</a>)</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        batch = self.<a class="code" href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">memory</a>.Transition(*zip(*transitions))</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        non_final_mask = torch.tensor(tuple(map(<span class="keyword">lambda</span> s: s <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>,</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                                batch.next_state)), device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>, dtype=torch.uint8)</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        non_final_next_states = torch.cat([s <span class="keywordflow">for</span> s <span class="keywordflow">in</span> batch.next_state <span class="keywordflow">if</span> s <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>])</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        state_batch = torch.cat(batch.state)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        action_batch = torch.cat(batch.action).unsqueeze(1)</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        reward_batch = torch.cat(batch.reward)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        q_action = self._net(state_batch).gather(1, action_batch)</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        q_action_next = torch.zeros(self.<a class="code" href="classAgency_1_1BaseAgent.html#a247146182d23b3ada0a4e851bedd3c37">_batch_size</a>, device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>)</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;        non_final_next_action_q  = self._target_net(non_final_next_states)</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        q_action_next[non_final_mask] = non_final_next_action_q.max(1)[0].detach()</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        td_target_actions = (q_action_next * self.<a class="code" href="classAgency_1_1BaseAgent.html#af1ed6712db1813e675955005c17bade6">_gamma</a>) + reward_batch</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        loss = F.mse_loss(q_action, td_target_actions.unsqueeze(1))</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a7809a1ed065d25c9c414b0a1176211d2">_optimizer</a>.zero_grad()</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        loss.backward()</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        self.<a class="code" href="classAgency_1_1BaseAgent.html#a7809a1ed065d25c9c414b0a1176211d2">_optimizer</a>.<a class="code" href="classAgency_1_1BaseAgent.html#a59f2f9a055e2c145bc83f610e26b8096">step</a>()</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">return</span> loss</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    </div><div class="line"><a name="l00398"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a9cb7dd560c63c2fe8d1967568b6a82ed">  398</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#a9cb7dd560c63c2fe8d1967568b6a82ed">print_status</a>(self):</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        print(<span class="stringliteral">&quot;Episode: {}\t Total pysc2 reward: {}\t Pseudo Reward: {}&quot;</span>.format(</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            self.e,self.<a class="code" href="classAgency_1_1BaseAgent.html#a0fd91f1d7a6e98d7a595a10cca3971f6">total_reward</a>,self.<a class="code" href="classAgency_1_1BaseAgent.html#a4b3bda54eb9c1193f6ede50f32e95a2d">reward</a>))</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        print(<span class="stringliteral">&quot;Epsilon: {:.4f}&quot;</span>.format(self.<a class="code" href="classAgency_1_1BaseAgent.html#aac02c4ec3cb8092b0658a5016ca34da5">epsilon</a>))</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        print(<span class="stringliteral">&quot;Beacon at {}&quot;</span>.format(self.<a class="code" href="classAgency_1_1BaseAgent.html#a63134b494c76d05c1368abba3cefad16">beacon</a>))</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        print(<span class="stringliteral">&quot;Marine at {}&quot;</span>.format((self.<a class="code" href="classAgency_1_1BaseAgent.html#aa1314c76c77fe992d5a3fa69ab5da6b3">marine_x</a>, self.<a class="code" href="classAgency_1_1BaseAgent.html#a65cbef666a469ae84ecf1dc5aa57181d">marine_y</a>)))</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        print(<span class="stringliteral">&quot;Loss: {}&quot;</span>.format(self.<a class="code" href="classAgency_1_1BaseAgent.html#ab36391d460027de65f3cbea93af9d86c">loss</a>))</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        print(self.<a class="code" href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">action</a>)</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        print(100 * <span class="stringliteral">&quot;=&quot;</span>)</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    </div><div class="line"><a name="l00416"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#aa06a4883d4637c0fdfca1d8d37f94069">  416</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classAgency_1_1BaseAgent.html#aa06a4883d4637c0fdfca1d8d37f94069">play</a>(self):</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">for</span> self.e <span class="keywordflow">in</span> range(1, self.<a class="code" href="classAgency_1_1BaseAgent.html#ae50cf15d8a8e27257ebfc147109eee71">_epochs</a>):</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            <span class="keywordflow">try</span>:</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                <span class="comment"># get first observation</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                observation = self.<a class="code" href="classAgency_1_1BaseAgent.html#a600366eed556fa0c9d077ae5635c244a">_env</a>.reset()</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                </div><div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">  422</a></span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a> = observation[0]</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                <span class="keywordflow">while</span> (<span class="keyword">True</span>):</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                    </div><div class="line"><a name="l00425"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#ad1ba1f291bc8f4360668c8e02186f83a">  425</a></span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#ad1ba1f291bc8f4360668c8e02186f83a">state</a> = torch.tensor([self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.observation.feature_screen.player_relative],</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                      dtype=torch.float, device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>, requires_grad = <span class="keyword">True</span>).unsqueeze(1)</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                    <span class="comment"># agent deterines action to take</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#a59f2f9a055e2c145bc83f610e26b8096">step</a>()</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    </div><div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">  431</a></span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">next_obs</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a600366eed556fa0c9d077ae5635c244a">_env</a>.<a class="code" href="classAgency_1_1BaseAgent.html#a59f2f9a055e2c145bc83f610e26b8096">step</a>(self.<a class="code" href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">action</a>)</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                    <span class="comment"># get pseudo reward</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#a663f1d2913fa6a467077a55ddf854dae">calc_pseudo_reward</a>()</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    <span class="comment"># if in last step, write only None in next state</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">next_obs</a>[0].last():</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                        </div><div class="line"><a name="l00438"></a><span class="lineno"><a class="line" href="classAgency_1_1BaseAgent.html#a63181f746aea31b031c03050f2c4996f">  438</a></span>&#160;                        self.<a class="code" href="classAgency_1_1BaseAgent.html#a63181f746aea31b031c03050f2c4996f">next_state</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                        self.<a class="code" href="classAgency_1_1BaseAgent.html#a63181f746aea31b031c03050f2c4996f">next_state</a> = torch.tensor([self.<a class="code" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">next_obs</a>[0].observation.feature_screen.player_relative],\</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                                                       dtype=torch.float, device=self.<a class="code" href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">_device</a>,</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                                       requires_grad = <span class="keyword">True</span>).unsqueeze(1)</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                    <span class="comment"># save transition</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">memory</a>.push(self.<a class="code" href="classAgency_1_1BaseAgent.html#ad1ba1f291bc8f4360668c8e02186f83a">state</a>, self.<a class="code" href="classAgency_1_1BaseAgent.html#adcc438ca0e3c70602fc3fd8941380dfd">action_idx</a>, self.<a class="code" href="classAgency_1_1BaseAgent.html#a4b3bda54eb9c1193f6ede50f32e95a2d">reward</a> , self.<a class="code" href="classAgency_1_1BaseAgent.html#a63181f746aea31b031c03050f2c4996f">next_state</a>,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                                     self.<a class="code" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">next_obs</a>[0].step_type.value)</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    <span class="comment"># state &lt;- next state</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">next_obs</a>[0]</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                    <span class="comment"># train/optimize</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#ab36391d460027de65f3cbea93af9d86c">loss</a> = self.<a class="code" href="classAgency_1_1BaseAgent.html#adef4f441aa6cbd1f3bb2c85839b9f403">optimize</a>()</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                    <span class="comment"># print status message</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#a9cb7dd560c63c2fe8d1967568b6a82ed">print_status</a>()</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                    <span class="comment"># if in terminal state, break</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                    <span class="keywordflow">if</span> self.<a class="code" href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">next_obs</a>[0].last()==<span class="keyword">True</span>:</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                        <span class="keywordflow">break</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="comment"># reward book keeping</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#ad1faa8d7c16f35e8b83a0e3ae176f59c">r_per_epoch</a>.append(self.<a class="code" href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">actual_obs</a>.observation[<span class="stringliteral">&quot;score_cumulative&quot;</span>][0])</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#a1a07b769c1dc93900667c4fa575e78a2">list_score_cumulative</a>.append(self.<a class="code" href="classAgency_1_1BaseAgent.html#a0fd91f1d7a6e98d7a595a10cca3971f6">total_reward</a>)</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                <span class="comment"># update target network weights every _target_update epochs</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                <span class="comment"># also save the model state dictionary</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                <span class="keywordflow">if</span> self.e % self.<a class="code" href="classAgency_1_1BaseAgent.html#aa98b4697dd1efc2617cdff5a6f0a76a6">_target_update</a> == 0:</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                    self._target_net.load_state_dict(self._net.state_dict())</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#a101857f27c887a9599d064f582e58bfc">_save_model</a>()</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                    self.<a class="code" href="classAgency_1_1BaseAgent.html#a387d924de5e98fc7e87e5750ffbc8116">log_reward</a>()</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="keywordflow">except</span> KeyboardInterrupt:</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                print(<span class="stringliteral">&quot;KeyboardInterrupt detected, saving model and data!&quot;</span>)</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#a101857f27c887a9599d064f582e58bfc">_save_model</a>()</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                self.<a class="code" href="classAgency_1_1BaseAgent.html#a387d924de5e98fc7e87e5750ffbc8116">log_reward</a>()</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                <span class="keywordflow">break</span></div><div class="ttc" id="classAgency_1_1BaseAgent_html_a63181f746aea31b031c03050f2c4996f"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a63181f746aea31b031c03050f2c4996f">Agency.BaseAgent.next_state</a></div><div class="ttdeci">next_state</div><div class="ttdoc">next_state is the more verbose version of next_obs and also used by the network </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00438">Agency.py:438</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a942e0ae66a7f7382a1176e49729979d1"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a942e0ae66a7f7382a1176e49729979d1">Agency.BaseAgent._path</a></div><div class="ttdeci">_path</div><div class="ttdoc">where to save model and reward csv </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00094">Agency.py:94</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a663f1d2913fa6a467077a55ddf854dae"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a663f1d2913fa6a467077a55ddf854dae">Agency.BaseAgent.calc_pseudo_reward</a></div><div class="ttdeci">def calc_pseudo_reward(self)</div><div class="ttdoc">calculate a pseudo reward in order to handle sparse rewards </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00316">Agency.py:316</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html"><div class="ttname"><a href="classAgency_1_1BaseAgent.html">Agency.BaseAgent</a></div><div class="ttdoc">Documentation for BaseAgent. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00087">Agency.py:87</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a27248be7da0c8a830b7a7e60a4c96344"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a27248be7da0c8a830b7a7e60a4c96344">Agency.BaseAgent.next_obs</a></div><div class="ttdeci">next_obs</div><div class="ttdoc">next_obs is the next state but densely encoded by the pysc2 engine </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00431">Agency.py:431</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a901aab539081be07996dca97de2f2e06"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a901aab539081be07996dca97de2f2e06">Agency.BaseAgent.decide</a></div><div class="ttdeci">def decide(self)</div><div class="ttdoc">determins if the next action is goint to be random or greedy </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00233">Agency.py:233</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a4b3bda54eb9c1193f6ede50f32e95a2d"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a4b3bda54eb9c1193f6ede50f32e95a2d">Agency.BaseAgent.reward</a></div><div class="ttdeci">reward</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00336">Agency.py:336</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ab36391d460027de65f3cbea93af9d86c"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ab36391d460027de65f3cbea93af9d86c">Agency.BaseAgent.loss</a></div><div class="ttdeci">loss</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00452">Agency.py:452</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aaae52ad633814dfe257eed442f5f4b7e"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aaae52ad633814dfe257eed442f5f4b7e">Agency.BaseAgent._memory_size</a></div><div class="ttdeci">_memory_size</div><div class="ttdoc">Replay Buffer capacity. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00106">Agency.py:106</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_a7792c36c85702b20aadfd91ec4c4326f"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#a7792c36c85702b20aadfd91ec4c4326f">Agency.ReplayBuffer.__len__</a></div><div class="ttdeci">def __len__(self)</div><div class="ttdoc">returns current number of saved transitions </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00060">Agency.py:60</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a9b17cee37319f16020cee6a23321c893"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a9b17cee37319f16020cee6a23321c893">Agency.BaseAgent.x_coord</a></div><div class="ttdeci">x_coord</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00264">Agency.py:264</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a76d7d38e700e7d5a3da83bf2c3237856"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a76d7d38e700e7d5a3da83bf2c3237856">Agency.BaseAgent._map_name</a></div><div class="ttdeci">_map_name</div><div class="ttdoc">Name of the scneario/map. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00112">Agency.py:112</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a600366eed556fa0c9d077ae5635c244a"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a600366eed556fa0c9d077ae5635c244a">Agency.BaseAgent._env</a></div><div class="ttdeci">_env</div><div class="ttdoc">initializing the pysc2 environment in order to play SC2 </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00143">Agency.py:143</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aa35d9fa21795e21339570f483d99b56c"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aa35d9fa21795e21339570f483d99b56c">Agency.BaseAgent.memory</a></div><div class="ttdeci">memory</div><div class="ttdoc">initializing of the ReplayBuffer </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00138">Agency.py:138</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ad1faa8d7c16f35e8b83a0e3ae176f59c"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ad1faa8d7c16f35e8b83a0e3ae176f59c">Agency.BaseAgent.r_per_epoch</a></div><div class="ttdeci">r_per_epoch</div><div class="ttdoc">array to kreep track of the reward per epoch </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00130">Agency.py:130</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_af61223f2986231e1ffc18b5ee1c58d4a"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#af61223f2986231e1ffc18b5ee1c58d4a">Agency.BaseAgent._lr</a></div><div class="ttdeci">_lr</div><div class="ttdoc">Learning rate for the optimizer. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00096">Agency.py:96</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a9a114098d693d23c2b6024bff9ab4e3c"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a9a114098d693d23c2b6024bff9ab4e3c">Agency.BaseAgent._xy_pairs</a></div><div class="ttdeci">_xy_pairs</div><div class="ttdoc">initializing the x,y coordinate pairs available to the agent </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00145">Agency.py:145</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_aa7be9fdc4ca2207005cb997ecd16cefe"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#aa7be9fdc4ca2207005cb997ecd16cefe">Agency.ReplayBuffer.capacity</a></div><div class="ttdeci">capacity</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00052">Agency.py:52</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ad0c1c3971f99373113ccfcb68f55ce61"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ad0c1c3971f99373113ccfcb68f55ce61">Agency.BaseAgent._xy_locs</a></div><div class="ttdeci">def _xy_locs(self, mask)</div><div class="ttdoc">returns the xy location of a given game-object, like a marine for example </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00205">Agency.py:205</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_ae1d76f1730f31d4fa36c7f7490e7fa2c"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#ae1d76f1730f31d4fa36c7f7490e7fa2c">Agency.ReplayBuffer.__init__</a></div><div class="ttdeci">def __init__(self, capacity)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00051">Agency.py:51</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a1a1ba863a11e4295203cadf4abcfeac3"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a1a1ba863a11e4295203cadf4abcfeac3">Agency.BaseAgent._EPS_START</a></div><div class="ttdeci">_EPS_START</div><div class="ttdoc">start value for epsilon decay </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00120">Agency.py:120</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a63134b494c76d05c1368abba3cefad16"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a63134b494c76d05c1368abba3cefad16">Agency.BaseAgent.beacon</a></div><div class="ttdeci">beacon</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00317">Agency.py:317</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a1a07b769c1dc93900667c4fa575e78a2"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a1a07b769c1dc93900667c4fa575e78a2">Agency.BaseAgent.list_score_cumulative</a></div><div class="ttdeci">list_score_cumulative</div><div class="ttdoc">list to keep track of the cumulative score </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00132">Agency.py:132</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a1f7d1b84d919eb3d2ce9092ad2161d1b"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a1f7d1b84d919eb3d2ce9092ad2161d1b">Agency.BaseAgent.choose_action</a></div><div class="ttdeci">def choose_action(self)</div><div class="ttdoc">chooses the next action </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00250">Agency.py:250</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a387d924de5e98fc7e87e5750ffbc8116"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a387d924de5e98fc7e87e5750ffbc8116">Agency.BaseAgent.log_reward</a></div><div class="ttdeci">def log_reward(self)</div><div class="ttdoc">logs rewards per epochs and cumulative reward in a csv file </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00219">Agency.py:219</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_adef4f441aa6cbd1f3bb2c85839b9f403"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#adef4f441aa6cbd1f3bb2c85839b9f403">Agency.BaseAgent.optimize</a></div><div class="ttdeci">def optimize(self)</div><div class="ttdoc">optimizes the network and updates the target network every _target_net_udpdate episodes ...</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00365">Agency.py:365</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a72269503c3be981fe59c51e6f46563c2"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a72269503c3be981fe59c51e6f46563c2">Agency.BaseAgent.action_xy</a></div><div class="ttdeci">action_xy</div><div class="ttdoc">the actual x,y pair which will be used in the next action </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00257">Agency.py:257</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html">Agency.ReplayBuffer</a></div><div class="ttdoc">Documentation for ReplayBuffer. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00044">Agency.py:44</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_ad4826e3b32056d091daed1120862760c"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#ad4826e3b32056d091daed1120862760c">Agency.ReplayBuffer.sample</a></div><div class="ttdeci">def sample(self, batch_size)</div><div class="ttdoc">return random sample transiton from experience </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00075">Agency.py:75</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ab1ef5401d902e7e79853793e386d80c5"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ab1ef5401d902e7e79853793e386d80c5">Agency.BaseAgent.action</a></div><div class="ttdeci">action</div><div class="ttdoc">the actual action which is used by the pysc2 enginge </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00289">Agency.py:289</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a0bfa57fad07747f81f83d3e6f2c8a493"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a0bfa57fad07747f81f83d3e6f2c8a493">Agency.BaseAgent.choice</a></div><div class="ttdeci">choice</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00238">Agency.py:238</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a101857f27c887a9599d064f582e58bfc"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a101857f27c887a9599d064f582e58bfc">Agency.BaseAgent._save_model</a></div><div class="ttdeci">def _save_model(self)</div><div class="ttdoc">saves the pytorch model </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00212">Agency.py:212</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ae50cf15d8a8e27257ebfc147109eee71"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ae50cf15d8a8e27257ebfc147109eee71">Agency.BaseAgent._epochs</a></div><div class="ttdeci">_epochs</div><div class="ttdoc">Number of epochs to train. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00104">Agency.py:104</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_abeb097dc014891c983b8cb5b993cb624"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#abeb097dc014891c983b8cb5b993cb624">Agency.BaseAgent.actual_obs</a></div><div class="ttdeci">actual_obs</div><div class="ttdoc">verbose state observation </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00422">Agency.py:422</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a59f2f9a055e2c145bc83f610e26b8096"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a59f2f9a055e2c145bc83f610e26b8096">Agency.BaseAgent.step</a></div><div class="ttdeci">def step(self)</div><div class="ttdoc">invokes one agent step by starting the pipeline to acquire the next action </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00300">Agency.py:300</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_aabee82626e7bdea8a188ae1fd7783430"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#aabee82626e7bdea8a188ae1fd7783430">Agency.ReplayBuffer.memory</a></div><div class="ttdeci">memory</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00053">Agency.py:53</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ac965ebdc21d12c9a39ce8e2b75f1c5b8"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ac965ebdc21d12c9a39ce8e2b75f1c5b8">Agency.BaseAgent._build_env</a></div><div class="ttdeci">def _build_env(self)</div><div class="ttdoc">construct the pysc2 environment in order to make the SC2 engine playable by the agent ...</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00170">Agency.py:170</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ad1ba1f291bc8f4360668c8e02186f83a"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ad1ba1f291bc8f4360668c8e02186f83a">Agency.BaseAgent.state</a></div><div class="ttdeci">state</div><div class="ttdoc">state tensor </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00425">Agency.py:425</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_af1ed6712db1813e675955005c17bade6"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#af1ed6712db1813e675955005c17bade6">Agency.BaseAgent._gamma</a></div><div class="ttdeci">_gamma</div><div class="ttdoc">Discount factor. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00098">Agency.py:98</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aa1314c76c77fe992d5a3fa69ab5da6b3"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aa1314c76c77fe992d5a3fa69ab5da6b3">Agency.BaseAgent.marine_x</a></div><div class="ttdeci">marine_x</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00325">Agency.py:325</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_a42eb421de8a87af670f58c2c9f47819c"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#a42eb421de8a87af670f58c2c9f47819c">Agency.ReplayBuffer.push</a></div><div class="ttdeci">def push(self, args)</div><div class="ttdoc">saves one transtion in the replay buffer/stack </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00068">Agency.py:68</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a0c5ff3459c502c25ed79b01c9d779b63"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a0c5ff3459c502c25ed79b01c9d779b63">Agency.BaseAgent._visualize</a></div><div class="ttdeci">_visualize</div><div class="ttdoc">Set to true to see actual game screen. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00108">Agency.py:108</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aefe924af6e56114594a6254df8ec0253"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aefe924af6e56114594a6254df8ec0253">Agency.BaseAgent._step_multiplier</a></div><div class="ttdeci">_step_multiplier</div><div class="ttdoc">How many game steps per agent step. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00114">Agency.py:114</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a3c1c2888e59101190c71795031e89b6c"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a3c1c2888e59101190c71795031e89b6c">Agency.BaseAgent._steps_done</a></div><div class="ttdeci">_steps_done</div><div class="ttdoc">step counter for epsilon calculation </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00124">Agency.py:124</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a247146182d23b3ada0a4e851bedd3c37"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a247146182d23b3ada0a4e851bedd3c37">Agency.BaseAgent._batch_size</a></div><div class="ttdeci">_batch_size</div><div class="ttdoc">Batch size. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00100">Agency.py:100</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_a74ddbf1602593e4d1de547773c61a67c"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#a74ddbf1602593e4d1de547773c61a67c">Agency.ReplayBuffer.position</a></div><div class="ttdeci">position</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00054">Agency.py:54</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a7809a1ed065d25c9c414b0a1176211d2"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a7809a1ed065d25c9c414b0a1176211d2">Agency.BaseAgent._optimizer</a></div><div class="ttdeci">_optimizer</div><div class="ttdoc">setting up the network, target network and optimizer </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00140">Agency.py:140</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_abdaf34c55cf5c82b49b0b6592380e3e1"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#abdaf34c55cf5c82b49b0b6592380e3e1">Agency.BaseAgent.pseudo_reward</a></div><div class="ttdeci">pseudo_reward</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00333">Agency.py:333</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a81e91b00ec8d40d267f39dbbd3c4a1d3"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a81e91b00ec8d40d267f39dbbd3c4a1d3">Agency.BaseAgent._device</a></div><div class="ttdeci">_device</div><div class="ttdoc">Train on GPU or CPU, default is GPU if available. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00110">Agency.py:110</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a65cbef666a469ae84ecf1dc5aa57181d"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a65cbef666a469ae84ecf1dc5aa57181d">Agency.BaseAgent.marine_y</a></div><div class="ttdeci">marine_y</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00326">Agency.py:326</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_ad6b534eb2f5e5d14a19504c543a061ac"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#ad6b534eb2f5e5d14a19504c543a061ac">Agency.ReplayBuffer.__getitem__</a></div><div class="ttdeci">def __getitem__(self, key)</div><div class="ttdoc">get transtion by index </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00064">Agency.py:64</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a7f90b138b07e8667a2fefd8f79e9b749"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a7f90b138b07e8667a2fefd8f79e9b749">Agency.BaseAgent._discretize_xy_grid</a></div><div class="ttdeci">def _discretize_xy_grid(self, factor)</div><div class="ttdoc">&quot;discretizes&quot; the x,y coordinate system into smaller parts in order to keep the action space smaller ...</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00191">Agency.py:191</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a001079ac67514da6784c687313065cea"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a001079ac67514da6784c687313065cea">Agency.BaseAgent._eps_decay</a></div><div class="ttdeci">_eps_decay</div><div class="ttdoc">Epsilon decay rate; high -&gt; slow decay. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00116">Agency.py:116</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_adcc438ca0e3c70602fc3fd8941380dfd"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#adcc438ca0e3c70602fc3fd8941380dfd">Agency.BaseAgent.action_idx</a></div><div class="ttdeci">action_idx</div><div class="ttdoc">the index of the x,y pair that is chosen </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00254">Agency.py:254</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a41d5c1c526ff266223f9b2e0ad7cf1c7"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a41d5c1c526ff266223f9b2e0ad7cf1c7">Agency.BaseAgent.y_coord</a></div><div class="ttdeci">y_coord</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00265">Agency.py:265</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aac02c4ec3cb8092b0658a5016ca34da5"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aac02c4ec3cb8092b0658a5016ca34da5">Agency.BaseAgent.epsilon</a></div><div class="ttdeci">epsilon</div><div class="ttdoc">epsilon, has to be initialized with 1.0 </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00118">Agency.py:118</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a06cd034442fe41432486654dfafa0937"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a06cd034442fe41432486654dfafa0937">Agency.BaseAgent.extract_action</a></div><div class="ttdeci">def extract_action(self)</div><div class="ttdoc">extracts the action from the list of available actions in the actual game </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00285">Agency.py:285</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aa9c49bc30c7714e60240621fa842c48f"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aa9c49bc30c7714e60240621fa842c48f">Agency.BaseAgent._name</a></div><div class="ttdeci">_name</div><div class="ttdoc">name of the experiment </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00092">Agency.py:92</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a0fd91f1d7a6e98d7a595a10cca3971f6"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a0fd91f1d7a6e98d7a595a10cca3971f6">Agency.BaseAgent.total_reward</a></div><div class="ttdeci">total_reward</div><div class="ttdoc">total reward achieved in training (pysc2 reward) </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00128">Agency.py:128</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_ad93eb985739706f8a17842953fda2d9c"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#ad93eb985739706f8a17842953fda2d9c">Agency.BaseAgent._EPS_END</a></div><div class="ttdeci">_EPS_END</div><div class="ttdoc">end value for epsilon decay </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00122">Agency.py:122</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a7ac4296207527be00adc988fa95af709"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a7ac4296207527be00adc988fa95af709">Agency.BaseAgent.pysc_action</a></div><div class="ttdeci">pysc_action</div><div class="ttdoc">the action id of the pysc2 action, necessary to extract the real action </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00270">Agency.py:270</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a0b87389e4d22e2272d198de09114faff"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a0b87389e4d22e2272d198de09114faff">Agency.BaseAgent._SMART_ACTIONS</a></div><div class="ttdeci">_SMART_ACTIONS</div><div class="ttdoc">actions available to the agent, chosen by design </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00134">Agency.py:134</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a9cb7dd560c63c2fe8d1967568b6a82ed"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a9cb7dd560c63c2fe8d1967568b6a82ed">Agency.BaseAgent.print_status</a></div><div class="ttdeci">def print_status(self)</div><div class="ttdoc">prints some status infos, e.g. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00398">Agency.py:398</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a7b6427b6a1ddf05110a588cbbcc7592b"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a7b6427b6a1ddf05110a588cbbcc7592b">Agency.BaseAgent._build_model</a></div><div class="ttdeci">def _build_model(self, architecture)</div><div class="ttdoc">construct the network, the target network and the optimizer </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00158">Agency.py:158</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aa98b4697dd1efc2617cdff5a6f0a76a6"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aa98b4697dd1efc2617cdff5a6f0a76a6">Agency.BaseAgent._target_update</a></div><div class="ttdeci">_target_update</div><div class="ttdoc">Update the target network every N epochs. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00102">Agency.py:102</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a806c86c1018317a32f8a2b297b465ff4"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a806c86c1018317a32f8a2b297b465ff4">Agency.BaseAgent.action_q_values</a></div><div class="ttdeci">action_q_values</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00260">Agency.py:260</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_a8000d3852f7eada76fd862a036e8c5ac"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#a8000d3852f7eada76fd862a036e8c5ac">Agency.BaseAgent.__init__</a></div><div class="ttdeci">def __init__(self, architecture, FLAGS, device=&quot;cpu&quot;)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00089">Agency.py:89</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aed81b1c10d3a9efe5e98d0e15fd72a8f"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aed81b1c10d3a9efe5e98d0e15fd72a8f">Agency.BaseAgent._choice</a></div><div class="ttdeci">_choice</div><div class="ttdoc">displays choice: random or greed, init with None </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00126">Agency.py:126</a></div></div>
<div class="ttc" id="classAgency_1_1BaseAgent_html_aa06a4883d4637c0fdfca1d8d37f94069"><div class="ttname"><a href="classAgency_1_1BaseAgent.html#aa06a4883d4637c0fdfca1d8d37f94069">Agency.BaseAgent.play</a></div><div class="ttdeci">def play(self)</div><div class="ttdoc">training loop </div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00416">Agency.py:416</a></div></div>
<div class="ttc" id="classAgency_1_1ReplayBuffer_html_a3472d419a502e3331128f223253d4a78"><div class="ttname"><a href="classAgency_1_1ReplayBuffer.html#a3472d419a502e3331128f223253d4a78">Agency.ReplayBuffer.Transition</a></div><div class="ttdeci">Transition</div><div class="ttdef"><b>Definition:</b> <a href="Agency_8py_source.html#l00055">Agency.py:55</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
